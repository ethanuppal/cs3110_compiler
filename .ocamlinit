open X86ISTMB
#install_printer Ast.pp_op
#install_printer Ast.pp_expr
#install_printer Ast.pp_stmt
#install_printer Ast.pp_prog
#install_printer Variable.pp
#install_printer Id.pp

let show_regalloc file =
  let source = Util.read_file file in
  let prog = Parse_lex.lex_and_parse source in
  let cfg = Ir_gen.generate prog |> List.hd in
  let liveliness = Liveliness.analysis_of cfg in
  let ordering = InstrOrdering.make cfg in
  print_endline (Cfg.to_string cfg);
  Regalloc.allocate_for cfg liveliness ordering |> Regalloc.VarTbl.to_seq |> List.of_seq